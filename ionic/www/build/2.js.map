{"version":3,"sources":["../../src/pages/device/device.module.ts","../../src/pages/device/device.ts"],"names":[],"mappings":"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","file":"2.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { DevicePage } from './device';\nimport { SuperTabsModule } from 'ionic2-super-tabs';\n\n@NgModule({\n  declarations: [\n    DevicePage,\n  ],\n  imports: [\n    SuperTabsModule,\n    IonicPageModule.forChild(DevicePage),\n  ],\n})\nexport class HomePageModule {}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/device/device.module.ts","import { AuthProvider } from './../../providers/auth/auth';\nimport { DeviceConsolePage } from './../device-console/device-console';\nimport { DeviceInfoPage } from './../device-info/device-info';\nimport { MqttProvider } from './../../providers/mqtt/mqtt';\nimport { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, Events } from 'ionic-angular';\nimport { Subscription } from 'rxjs/Subscription';\nimport { SocketIoProvider } from '../../providers/socket-io/socket-io';\n\n@IonicPage(\n  {\n    name: 'DevicePage',\n    segment: 'device/:id'\n  }\n)\n@Component({\n  selector: 'page-device',\n  templateUrl: 'device.html',\n})\nexport class DevicePage {\n\n  ctrlID: string = '';\n  tabs = [];\n  topic: string;\n  isMqttInit: boolean = false;\n  socketSubscription: Subscription;\n\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    private mqtt: MqttProvider,\n    private events: Events,\n    private auth: AuthProvider,\n    private socket: SocketIoProvider\n  ) {\n\n  }\n\n  ionViewCanEnter(): Promise<boolean> {\n    return this.auth.checkAuthentication()\n  }\n\n  ionViewWillLeave() {\n    // stop all subscription\n    this.events.publish('subscription:stop');\n    /*if (this.isMqttInit){\n      if(this.topic)\n        this.mqtt.unsubscribeTopic(this.topic);\n      this.mqtt.unregisterCallback(this.ctrlID);\n    }*/\n    if (this.topic) {\n      this.socket.unsubscribeTopic(this.topic)\n    }\n    if (this.socketSubscription) {\n      this.socketSubscription.unsubscribe();\n    }\n  }\n\n  ionViewDidLoad() {\n    if (this.navParams.get('id')) {\n      this.ctrlID = this.navParams.get('id');\n      this.tabs = [\n        {\n          page: DeviceInfoPage,\n          params: {\n            id: this.ctrlID\n          },\n          title: 'Info',\n          id: 'Info'\n        }, {\n          page: DeviceConsolePage,\n          params: {\n            id: this.ctrlID\n          },\n          title: 'Console',\n          id: 'Console'\n        }\n      ]\n\n      this.topic = this.ctrlID + '/#';\n\n      // register callback\n      /*this.mqtt.ready().then(() => {\n        this.isMqttInit = true;\n        this.mqtt.subscribeTopic(this.topic, 1);\n        this.mqtt.registerCallback(this.ctrlID, this.callback.bind(this))\n      })*/\n\n      this.socket.subscribeTopic(this.topic, 1);\n      this.socketSubscription = this.socket.getMessages().subscribe(data => {\n        this.callback(data)\n      })\n    }\n  }\n\n  callback(message) {\n    //console.log(message)\n    this.events.publish('subscription:mqtt', message)\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/device/device.ts"],"sourceRoot":""}